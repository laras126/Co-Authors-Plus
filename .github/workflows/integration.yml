name: CI

on: [push]

jobs:
  build-test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - php: 7.4
            wordpress: master
            phpunit: 7.5.20
#          - php: 7.3
#            wordpress: master
#            phpunit: 6.5.14
#          - php: 7.1
#            wordpress: master
#            phpunit: 6.5.14
#          - php: 7.0.33
#            wordpress: 4.9
#            phpunit: 6.5.14
#          - php: 5.6
#            wordpress: 4.7
#            phpunit: 5.0

    name: PHP ${{ matrix.php }} tests in WP ${{ matrix.wordpress }}
    steps:
      - uses: actions/checkout@v2

      - uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php }}
          tools: phpunit:${{ matrix.phpunit }}

      - name: Start MySQL service
        run: |
          sudo /etc/init.d/mysql start
#          mysql -u root -proot -e "CREATE DATABASE wordpress_tests;"

      - name: Install WordPress environment
        run: bash bin/install-wp-tests.sh wordpress_tests root root

      - name: Execute PHPUnit tests
        run: phpunit
